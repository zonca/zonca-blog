<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Run Jupyterhub on a Supercomputer | Andrea Zonca</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Run Jupyterhub on a Supercomputer" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Summary: I developed a plugin for Jupyterhub: RemoteSpawner, it has a proof-of-concept interface with the Supercomputer Gordon at UC San Diego to spawn IPython Notebook instances as jobs throught the queue and tunnel the interface back to the Jupyterhub instance." />
<meta property="og:description" content="Summary: I developed a plugin for Jupyterhub: RemoteSpawner, it has a proof-of-concept interface with the Supercomputer Gordon at UC San Diego to spawn IPython Notebook instances as jobs throught the queue and tunnel the interface back to the Jupyterhub instance." />
<link rel="canonical" href="https://zonca.dev/2015/04/jupyterhub-hpc.html" />
<meta property="og:url" content="https://zonca.dev/2015/04/jupyterhub-hpc.html" />
<meta property="og:site_name" content="Andrea Zonca" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-04-02T09:00:00-05:00" />
<script type="application/ld+json">
{"headline":"Run Jupyterhub on a Supercomputer","url":"https://zonca.dev/2015/04/jupyterhub-hpc.html","dateModified":"2015-04-02T09:00:00-05:00","datePublished":"2015-04-02T09:00:00-05:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://zonca.dev/2015/04/jupyterhub-hpc.html"},"description":"Summary: I developed a plugin for Jupyterhub: RemoteSpawner, it has a proof-of-concept interface with the Supercomputer Gordon at UC San Diego to spawn IPython Notebook instances as jobs throught the queue and tunnel the interface back to the Jupyterhub instance.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://zonca.dev/feed.xml" title="Andrea Zonca" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Andrea Zonca</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/consult/">Consulting</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Run Jupyterhub on a Supercomputer</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2015-04-02T09:00:00-05:00" itemprop="datePublished">
        Apr 2, 2015
      </time>
    </p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#ipython">ipython</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#jupyterhub">jupyterhub</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#hpc">hpc</a>
        
      
      </p>
    

      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/zonca/zonca-blog/tree/master/_posts/2015-04-02-jupyterhub-hpc.md" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

    </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <blockquote>
  <p><strong>Summary</strong>: I developed a plugin for <a href="https://github.com/jupyter/jupyterhub" title="jupyterhub">Jupyterhub</a>: <a href="https://github.com/zonca/remotespawner">RemoteSpawner</a>, it has a proof-of-concept interface with the Supercomputer Gordon at UC San Diego to spawn IPython Notebook instances as jobs throught the queue and tunnel the interface back to the Jupyterhub instance.</p>
</blockquote>

<p>The IPython (recently renamed Jupyter) Notebook is a powerful tool for analyzing and visualizing data in Python and other programming languages.
A key feature is that a single document contains code, figures, text and equations.
Everything is saved in a single .ipynb file that can be shared, executed and modified. See an <a href="http://nbviewer.ipython.org/github/waltherg/notebooks/blob/master/2013-12-03-Crank_Nicolson.ipynb" title="example notebook">example Notebook on integration of partial differential equations</a>.</p>

<p>The Jupyter Notebook is a Python application with a web frontend, i.e. the interface runs in the user browser.
This setup makes it suitable for any kind of remote computing, in particular running the Jupyter Notebook on a computing node of a Supercomputer, and exporting the interface HTTP port to a local browser.
Setting up tunneling via SSH is tedious, in particular if the user does not have a public IP address.</p>

<p><a href="https://github.com/jupyter/jupyterhub" title="jupyterhub">Jupyterhub</a>, developed by the Jupyter team, comes to the rescue by providing a web application that manages and proxies multiple instances of the Jupyter Notebook for any number of users.
Jupyterhub natively only spawns local processes, but supports plugins to extend its functionality.</p>

<p>I have been developing a proof-of-concept plugin (<a href="https://github.com/zonca/remotespawner">RemoteSpawner</a>) designed to work on a web server and once a user is authenticated, connect to the login node of a Supercomputer and submit a Jupyter Notebook job.
As soon as the job starts execution, it sets up SSH tunneling with the Jupyterhub host so that
Jupyterhub can provide the Notebook interface to the user.
This setup allows users to simply access a Supercomputer via browser, accessing all their Python environment and data.</p>

<p>I am looking for interested parties either as users or as collaborators to help further development. See more information about the project below.</p>

<h2 id="test-it-yourself">Test it yourself</h2>

<p>In order to have a feeling on how Jupyterhub works, you can test in your browser at:</p>

<ul>
  <li><a href="http://tmpnb.org">http://tmpnb.org</a></li>
</ul>

<p>This service by Rackspace creates temporary Jupyter Notebooks on the fly. If you click on <code class="language-plaintext highlighter-rouge">Welcome.ipynb</code>,
you can see an example Notebook.</p>

<p>The purpose of my project is to have a web interface to access Jupyter Notebooks that are
running on computing nodes of a Supercomputer. So that users can access the environment and
data on a Supercomputer from their browser and run data-intensive processing.</p>

<h2 id="tour-of-jupyterhub-on-the-gordon-supercomputer">Tour of Jupyterhub on the Gordon Supercomputer</h2>

<p>I’ll show some screenshots to display how a test Jupyterhub installation on my machine is integrated with <a href="http://www.sdsc.edu/us/resources/gordon/">Gordon</a> thanks to the plugin.</p>

<p>Jupyterhub is accessed publicly via browser and the user can login. Jupyterhub supports authentication for <code class="language-plaintext highlighter-rouge">PAM</code>/<code class="language-plaintext highlighter-rouge">LDAP</code> so it could be integrated with XSEDE credential, at the moment I am testing with local authentication.</p>

<p><img src="/images/jupyterhub-hpc-login.png" alt="jupyterhub-hpc-login.png" /></p>

<p>Once the user is authenticated, Jupyterhub connects via <code class="language-plaintext highlighter-rouge">SSH</code> to a login node on Gordon and submits a batch serial job using <code class="language-plaintext highlighter-rouge">qsub</code>. The web interface waits for the job to start running. A dedicated queue with a quick turnaround would be useful for this kind of jobs.</p>

<p><img src="/images/jupyterhub-hpc-refresh.png" alt="jupyterhub-hpc-refresh.png" />
<img src="/images/jupyterhub-hpc-job.png" alt="jupyterhub-hpc-job.png" /></p>

<p>When the job starts running, it first sets up <code class="language-plaintext highlighter-rouge">SSH</code> tunneling between the Jupyterhub host and the computing node, then starts the Jupyter Notebook.
As soon as the web interface detects that the job is running, proxies the tunneled HTTP port for the user. From this point the Jupyter Notebook works exactly like it would on a local machine.</p>

<p>See an example Notebook printing the hostname of the computing node:</p>

<p><img src="/images/jupyterhub-hpc-testnotebook.png" alt="jupyterhub-hpc-testnotebook.png" /></p>

<p>Other two useful features of the Jupyter Notebook are a terminal:</p>

<p><img src="/images/jupyterhub-hpc-terminal.png" alt="jupyterhub-hpc-terminal.png" /></p>

<p>and an editor that run in the browser:</p>

<p><img src="/images/jupyterhub-hpc-editor.png" alt="jupyterhub-hpc-editor.png" /></p>

<h2 id="launch-jupyterhub-parallel-to-access-hundreds-of-computing-engines">Launch Jupyterhub parallel to access hundreds of computing engines</h2>

<p>The Notebook also supports using Torque to run Python computing engines and send them computationally intensive serial functions for load-balanced execution.</p>

<p>In the Notebook interface, in the <code class="language-plaintext highlighter-rouge">Clusters</code> tab, is it possible to choose the number of engines and click start to submit a job to the queue system:</p>

<p><img src="/images/jupyterhub-hpc-clusterlaunch.png" alt="jupyterhub-hpc-clusterlaunch.png" /></p>

<p>This will pack 16 jobs per node (Gordon has 16-cores CPUs) and make them available from the notebook, see an example usage where I process 1000 files with 128 engines running on a different job on Gordon:</p>

<ul>
  <li><a href="http://nbviewer.ipython.org/gist/zonca/9bd94d8782af037704ff">Example of Jupyterhub Parallel</a></li>
</ul>


  </div><a class="u-url" href="/2015/04/jupyterhub-hpc.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Tutorials and blog posts by Andrea Zonca: Python, Jupyter, Kubernetes</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/zonca" target="_blank" title="zonca"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/andreazonca" target="_blank" title="andreazonca"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
