<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>IPython/Jupyter notebook setup on SDSC Comet | Andrea Zonca</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="IPython/Jupyter notebook setup on SDSC Comet" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction" />
<meta property="og:description" content="Introduction" />
<link rel="canonical" href="https://zonca.dev/2015/09/ipython-jupyter-notebook-sdsc-comet.html" />
<meta property="og:url" content="https://zonca.dev/2015/09/ipython-jupyter-notebook-sdsc-comet.html" />
<meta property="og:site_name" content="Andrea Zonca" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-09-17T20:00:00-05:00" />
<script type="application/ld+json">
{"headline":"IPython/Jupyter notebook setup on SDSC Comet","url":"https://zonca.dev/2015/09/ipython-jupyter-notebook-sdsc-comet.html","dateModified":"2015-09-17T20:00:00-05:00","datePublished":"2015-09-17T20:00:00-05:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://zonca.dev/2015/09/ipython-jupyter-notebook-sdsc-comet.html"},"description":"Introduction","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://zonca.dev/feed.xml" title="Andrea Zonca" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Andrea Zonca</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/consult/">Consulting</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">IPython/Jupyter notebook setup on SDSC Comet</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2015-09-17T20:00:00-05:00" itemprop="datePublished">
        Sep 17, 2015
      </time>
    </p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#ipython">ipython</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#jupyter">jupyter</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#ipython-notebook">ipython-notebook</a>
        
      
      </p>
    

      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/zonca/zonca-blog/tree/master/_posts/2015-09-17-ipython-jupyter-notebook-sdsc-comet.md" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

    </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="introduction">Introduction</h2>

<p>This tutorial explains the setup to run an IPython Notebook on a computing node on the supercomputer Comet at the San Diego Supercomputer Center and forward the port encrypted with SSH to the browser on a local laptop.</p>

<h2 id="quick-reference">Quick reference</h2>

<ul>
  <li>Add <code class="language-plaintext highlighter-rouge">module load python scipy</code> to <code class="language-plaintext highlighter-rouge">.bashrc</code></li>
  <li>Make sure you can ssh passwordless within comet, i.e. <code class="language-plaintext highlighter-rouge">ssh comet.sdsc.edu</code> from comet  login node works without password</li>
  <li>Get <code class="language-plaintext highlighter-rouge">submit_slurm_comet.sh</code> from <a href="https://gist.github.com/zonca/5f8b5ccb826a774d3f89">https://gist.github.com/zonca/5f8b5ccb826a774d3f89</a></li>
  <li>Change the port number and customize options (duration)</li>
  <li><code class="language-plaintext highlighter-rouge">sbatch submit_slurm_comet.sh</code></li>
  <li>Remember the login node you are using</li>
  <li>From laptop, use <code class="language-plaintext highlighter-rouge">bash tunnel_notebook_comet.sh N</code> where N is the Comet login number (e.g. 2) from <a href="https://gist.github.com/zonca/5f8b5ccb826a774d3f89">https://gist.github.com/zonca/5f8b5ccb826a774d3f89</a></li>
  <li>From laptop, open browser and connect to <code class="language-plaintext highlighter-rouge">http://localhost:YOURPORT</code></li>
</ul>

<h2 id="detailed-walkthrough">Detailed walkthrough</h2>

<h3 id="one-time-setup-on-comet">One time setup on Comet</h3>

<p>Login into a Comet login node, edit the <code class="language-plaintext highlighter-rouge">.bashrc</code> file in your home folder (with <code class="language-plaintext highlighter-rouge">nano .bashrc</code> for example) and add <code class="language-plaintext highlighter-rouge">module load python scipy</code> at the bottom. This makes sure you always have the Python environment loaded in all your jobs. Logout, log back in, make sure that <code class="language-plaintext highlighter-rouge">module list</code> shows <code class="language-plaintext highlighter-rouge">python</code> and <code class="language-plaintext highlighter-rouge">scipy</code>.</p>

<p>You need to be able to SSH from a node to another node on comet with no need of a password. Create a new SSH certificate with <code class="language-plaintext highlighter-rouge">ssh-keygen</code>, hit enter to keep all default options, DO NOT ENTER A PASSWORD. Then use <code class="language-plaintext highlighter-rouge">ssh-copy-id comet.sdsc.edu</code>, enter your password to make sure the key is copied in the authorized hosts.
Now you can check it works by executing:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh comet.sdsc.edu
</code></pre></div></div>

<p>from the login node and make sure you are NOT asked for your password.</p>

<h3 id="configure-the-script-for-slurm-and-submit-the-job">Configure the script for SLURM and submit the job</h3>

<p>Copy <code class="language-plaintext highlighter-rouge">submit_slurm_comet.sh</code> from <a href="https://gist.github.com/zonca/5f8b5ccb826a774d3f89">https://gist.github.com/zonca/5f8b5ccb826a774d3f89</a> on your home on Comet.</p>

<p>Change the port number in the script to a port of your choosing between 8000 and 9999, referenced as YOURPORT in the rest of the tutorial. Two users on the same login node on the same port would not be allowed to forward, so try to avoid common port numbers as 8000, 9000, 8080 or 8888. Tho</p>

<p>Choose whether you prefer to use a full node to have access to all 24 cores and 128GB of RAM or if you only need 1 core and 5GB of RAM and change the top of the script accordingly.</p>

<p>Choose a duration of your job, for initial testing better keep 30 minutes so your job starts straight away.</p>

<p>Submit the job to the scheduler:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbatch submit_slurm_comet.sh
</code></pre></div></div>

<p>Wait for the job to start running, you should see <code class="language-plaintext highlighter-rouge">R</code> in:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>squeue -u $USER
</code></pre></div></div>

<p>The script launches an IPython notebook on a computing node and tunnels its port to the login node.</p>

<p>You can check that everything worked by checking that no errors show up in the <code class="language-plaintext highlighter-rouge">notebook.log</code> file, and that you can access the notebook page with <code class="language-plaintext highlighter-rouge">wget</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget localhost:YOURPORT
</code></pre></div></div>

<p>should download a <code class="language-plaintext highlighter-rouge">index.html</code> file in the current folder, and NOT give an error like “Connection refused”.</p>

<p>Check what login node you were using on comet, i.e. the hostname on your terminal on comet, for example <code class="language-plaintext highlighter-rouge">comet-ln2</code>.</p>

<h3 id="tunnel-the-port-to-your-laptop">Tunnel the port to your laptop</h3>

<h4 id="linux--mac">Linux / MAC</h4>

<p>Download the <code class="language-plaintext highlighter-rouge">tunnel_notebook_comet.sh</code> script from <a href="https://gist.github.com/zonca/5f8b5ccb826a774d3f89">https://gist.github.com/zonca/5f8b5ccb826a774d3f89</a>.</p>

<p>Customize the script with your port number.</p>

<p>Lauch <code class="language-plaintext highlighter-rouge">bash tunnel_notebook_comet.sh N</code> where N is the comet login node number. So if you were on <code class="language-plaintext highlighter-rouge">comet-ln2</code>, use <code class="language-plaintext highlighter-rouge">bash tunnel_notebook_comet.sh 2</code>.</p>

<p>The script forwards the port from the login node of comet to your laptop.</p>

<h4 id="windows">Windows</h4>

<p>Install <code class="language-plaintext highlighter-rouge">putty</code>.</p>

<p>Follow tutorial for local port forwarding on <a href="https://www.akadia.com/services/ssh_putty.html/">https://www.akadia.com/services/ssh_putty.html/</a></p>

<ul>
  <li>set <code class="language-plaintext highlighter-rouge">comet-ln2.sdsc.edu</code> as remote host, 22 as SSH port</li>
  <li>set YOURPORT as tunnel port, replace both 8080 and 80 in the tutorial with your port number.</li>
</ul>

<h3 id="connect-to-the-notebook">Connect to the Notebook</h3>

<p>Open a browser and type <code class="language-plaintext highlighter-rouge">http://localhost:YOURPORT</code> in the address bar.</p>

  </div><a class="u-url" href="/2015/09/ipython-jupyter-notebook-sdsc-comet.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Tutorials and blog posts by Andrea Zonca: Python, Jupyter, Kubernetes</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/zonca" target="_blank" title="zonca"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/andreazonca" target="_blank" title="andreazonca"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
