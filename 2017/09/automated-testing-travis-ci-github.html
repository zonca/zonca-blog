<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Setup automated testing on a Github repository with Travis-ci | Andrea Zonca</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Setup automated testing on a Github repository with Travis-ci" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction" />
<meta property="og:description" content="Introduction" />
<link rel="canonical" href="https://zonca.dev/2017/09/automated-testing-travis-ci-github.html" />
<meta property="og:url" content="https://zonca.dev/2017/09/automated-testing-travis-ci-github.html" />
<meta property="og:site_name" content="Andrea Zonca" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-09-06T18:00:00-05:00" />
<script type="application/ld+json">
{"headline":"Setup automated testing on a Github repository with Travis-ci","url":"https://zonca.dev/2017/09/automated-testing-travis-ci-github.html","dateModified":"2017-09-06T18:00:00-05:00","datePublished":"2017-09-06T18:00:00-05:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://zonca.dev/2017/09/automated-testing-travis-ci-github.html"},"description":"Introduction","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://zonca.dev/feed.xml" title="Andrea Zonca" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Andrea Zonca</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/consult/">Consulting</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Setup automated testing on a Github repository with Travis-ci</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2017-09-06T18:00:00-05:00" itemprop="datePublished">
        Sep 6, 2017
      </time>
    </p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#github">github</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#travis">travis</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#git">git</a>
        
      
      </p>
    

      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/zonca/zonca-blog/tree/master/_posts/2017-09-06-continous-integration-travis-ci-github.md" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

    </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="introduction">Introduction</h2>

<p>It is good practice in software development to implement extensive testing of the codebase in order to catch quickly any bug introduced into the code when implementing new features.</p>

<p>The suite of tests should be easy to execute (possibly one single command, for example with the <code class="language-plaintext highlighter-rouge">py.test</code> runner) and quick to run (more than 1 minute would make it tedious to run).</p>

<p>The developers should run the unit test suite every time they implement a change to the codebase to make sure anything else has not been broken.</p>

<p>However, once a commit has been pushed to Github, it is also useful to have automated testing executed automatically, at least for 2 reasons:</p>

<ul>
  <li>Run tests in all the environments that need to be supported by the software, for example run with different versions of Python or different versions of a key required external dependancy</li>
  <li>Run tests in a clean environment that has less risks of being contaminated by some mis-configuration on one of the developers’ environments</li>
</ul>

<h2 id="travis-ci">Travis-CI</h2>

<p>Travis is a free web based service that allows to register a trigger on Github so that every time a commit is pushed to Github or a Pull Request is opened, it launches an isolated Ubuntu (even if it also supports Mac OS) container for each of the configurations that we want to test, builds the software (if needed) and then runs the test.</p>

<p>The only requirement is that the Github project needs to be public for the free service. Otherwise there are paid plans for private repositories.</p>

<h2 id="setup-on-travis-ci">Setup on Travis-CI</h2>

<ul>
  <li>Go to <a href="http://travis-ci.org">http://travis-ci.org</a> and login with a Github account</li>
  <li>In order to automatatically configure the hook on Github, Travis requests writing privileges to your Github account, annoying but convenient</li>
  <li>Leave all default options, just make sure that Pull Requests are automatically tested</li>
  <li>If you have the repository both under an organization and a fork under your account, you can choose either to test both or just the organization repository, anyway your pull requests will be tested before merging.</li>
</ul>

<h2 id="preparation-of-the-test-scripts">Preparation of the test scripts</h2>

<p>In order to automate running the test scripts on Travis-CI, it is important that the test scripts return a exit code different from zero to signal that the tests failed.</p>

<p>If you are using a test running tool like <code class="language-plaintext highlighter-rouge">pytest</code>, this is automatically done for you. If you are using bash scripts instead, make sure that if the script detects an error it calls <code class="language-plaintext highlighter-rouge">exit 1</code>.
In order to automate running the test scripts on Travis-CI, it is important that the test scripts return a exit code different from zero to signal that the tests failed.</p>

<p>If you are using a test running tool like <code class="language-plaintext highlighter-rouge">pytest</code>, this is automatically done for you. If you are using bash scripts instead, make sure that if the script detects an error it calls <code class="language-plaintext highlighter-rouge">exit 1</code>.</p>

<h2 id="configuration-of-the-repository">Configuration of the repository</h2>

<ul>
  <li>
    <p>Create a new branch on your repository:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  git checkout -b test_travis
</code></pre></div>    </div>
  </li>
  <li>Add a <code class="language-plaintext highlighter-rouge">.travis.yml</code> (mind that it starts with a dot) configuration file</li>
  <li>
    <p>Inside this file you can configure how your project is built and tested, for the simple case of <code class="language-plaintext highlighter-rouge">bash</code> or <code class="language-plaintext highlighter-rouge">perl</code> scripts you can just write:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  dist: trusty
  language: bash

  script:
      - cd $TRAVIS_BUILD_DIR/tests; bash run_test.sh
</code></pre></div>    </div>
  </li>
  <li>Check the Travis-CI documentation for advanced configuration options</li>
  <li>Now push these changes to your fork of the main repository  and then create a Pull Request to the main repository</li>
  <li>Go to <a href="https://travis-ci.org/YOUR_ORGANIZATION/YOUR_REPO">https://travis-ci.org/YOUR_ORGANIZATION/YOUR_REPO</a> to check the build status and the log</li>
  <li>Once your Pull Request passes the tests, merge it to the main repository so that also the master branch will be tested for all future commits.</li>
</ul>

<h2 id="python-example">Python example</h2>

<p>In the following example, Travis-CI will create 8 builds, each of the 4 versions of Python will be tested with the 2 versions of <code class="language-plaintext highlighter-rouge">numpy</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>language: python
python:
  - "2.7"
  - "3.4"
  - "3.5"
  - "3.6"
env:
  - NUMPY_VERSION=1.12.1
  - NUMPY_VERSION=1.13.1
# command to install dependencies, requirements.txt should NOT include numpy
install:
  - pip install -r requirements.txt numpy==$NUMPY_VERSION
# command to run tests
script:
  - pytest # or py.test for Python versions 3.5 and below
</code></pre></div></div>

<h2 id="badge-in-readme">Badge in README</h2>

<p>Aestetic touch, left click on the “Build Passing” image on the Travis-CI page for your repository, choose “Markdown” and paste the code to the <code class="language-plaintext highlighter-rouge">README.md</code> of your repository on Github. This will show in real time if the last version of the code is passing the tests or not.</p>

  </div><a class="u-url" href="/2017/09/automated-testing-travis-ci-github.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Tutorials and blog posts by Andrea Zonca: Python, Jupyter, Kubernetes</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/zonca" target="_blank" title="zonca"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/andreazonca" target="_blank" title="andreazonca"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
